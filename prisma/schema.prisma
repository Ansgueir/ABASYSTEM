generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  passwordHash       String
  role               UserRole
  isActive           Boolean             @default(true)
  isFirstLogin       Boolean             @default(true)
  onboardingCompleted Boolean            @default(false)
  onboardingStep     Int                 @default(0)
  signatureUrl       String?
  initialsUrl        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  uploadedDocuments  Document[]
  officeMember       OfficeMember?
  repeatingSchedules RepeatingSchedule[]
  student            Student?
  supervisor         Supervisor?
  notifications      Notification[]
}

model Notification {
  id        String           @id @default(uuid())
  userId    String
  title     String
  message   String
  type      NotificationType @default(SYSTEM)
  isRead    Boolean          @default(false)
  link      String?
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Student {
  id                    String                       @id @default(uuid())
  userId                String                       @unique
  fullName              String
  paymentAlias          String[]
  supervisorId          String?
  bacbId                String                       @db.VarChar(10)
  credential            CredentialType
  school                String
  level                 LevelType
  phone                 String
  email                 String
  address               String              @default("")
  city                  String
  state                 String
  startDate             DateTime
  supervisionType       SupervisionType
  fieldworkType         FieldworkType       @default(REGULAR)
  supervisionPercentage Decimal
  hoursToDo             Int
  hoursToPay            Int
  amountToPay           Decimal                      @db.Decimal(10, 2)
  hourlyRate            Decimal                      @default(0) @db.Decimal(10, 2)
  hoursPerMonth         Int
  totalMonths           Int
  endDate               DateTime
  status                StudentStatus                @default(ACTIVE)
  availableDaysGroup    String[]
  notes                 String?
  createdAt             DateTime                     @default(now())
  updatedAt             DateTime                     @updatedAt
  academicDegree        String?
  contractStartDate     DateTime?
  contracts             Contract[]
  documents             Document[]
  groupAttendance       GroupSupervisionAttendance[]
  independentHours      IndependentHour[]
  invoices              Invoice[]
  supervisor            Supervisor?                  @relation(fields: [supervisorId], references: [id])
  user                  User                         @relation(fields: [userId], references: [id])
  evaluations           StudentEvaluation[]
  payments              StudentPayment[]
  supervisionHours      SupervisionHour[]
  supervisorPayments    SupervisorPayment[]
  @@index([fullName])
  @@index([email])
}

model Supervisor {
  id                 String                    @id @default(uuid())
  userId             String                    @unique
  fullName           String
  phone              String
  email              String
  address            String
  bacbId             String
  certificantNumber  String
  examDate           DateTime?
  training8hrDate    DateTime?
  availableDaysGroup String[]
  monthStarted       DateTime?
  status             SupervisorStatus          @default(ACTIVE)
  companyName        String?
  taxId              String?
  bankName           String?
  routingNumber      String?
  accountNumber      String?
  canEnterGroupHours Boolean                   @default(false)
  rateRegular        Decimal?                  @db.Decimal(10, 2)
  rateConcentrated   Decimal?                  @db.Decimal(10, 2)
  paymentPercentage  Decimal?                  @db.Decimal(5, 4)
  comments           String?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  credentialType     CredentialType            @default(BCBA)
  maxStudents        Int                       @default(10)
  documents          Document[]
  groupSessions      GroupSupervisionSession[]
  students           Student[]
  evaluations        StudentEvaluation[]
  supervisionHours   SupervisionHour[]
  user               User                      @relation(fields: [userId], references: [id])
  payments           SupervisorPayment[]
  contracts          ContractSupervisor[]
  @@index([fullName])
  @@index([email])
}

model OfficeMember {
  id          String   @id @default(uuid())
  userId      String   @unique
  fullName    String
  officeRole  OfficeRole  @default(ADMIN)
  permissions Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])
  @@index([fullName])
}

model IndependentHour {
  id                  String             @id @default(uuid())
  studentId           String
  date                DateTime
  startTime           DateTime
  hours               Decimal            @db.Decimal(4, 2)
  setting             SettingType
  activityType        ActivityType
  notes               String?
  isRepeating         Boolean            @default(false)
  repeatingScheduleId String?
  status              HourStatus         @default(PENDING)
  rejectReason        String?
  createdAt           DateTime           @default(now())
  repeatingSchedule   RepeatingSchedule? @relation(fields: [repeatingScheduleId], references: [id])
  student             Student            @relation(fields: [studentId], references: [id])
}

model SupervisionHour {
  id                  String             @id @default(uuid())
  studentId           String
  supervisorId        String
  date                DateTime
  startTime           DateTime
  hours               Decimal            @db.Decimal(4, 2)
  supervisionType     SupervisionFormat
  setting             SettingType
  activityType        ActivityType
  notes               String?
  groupTopic          String?
  isRepeating         Boolean            @default(false)
  repeatingScheduleId String?
  status              HourStatus         @default(PENDING)
  rejectReason        String?
  amountBilled        Decimal?           @db.Decimal(10, 2)
  supervisorPay       Decimal?           @db.Decimal(10, 2)
  invoiceId           String?
  createdAt           DateTime           @default(now())
  invoice             Invoice?           @relation(fields: [invoiceId], references: [id])
  repeatingSchedule   RepeatingSchedule? @relation(fields: [repeatingScheduleId], references: [id])
  student             Student            @relation(fields: [studentId], references: [id])
  supervisor          Supervisor         @relation(fields: [supervisorId], references: [id])
}

model RepeatingSchedule {
  id                      String            @id @default(uuid())
  userId                  String
  name                    String
  frequencyType           String
  frequencyValue          Int
  daysOfWeek              String[]
  endAfterOccurrences     Int?
  endDate                 DateTime?
  templateData            Json
  isActive                Boolean           @default(true)
  createdAt               DateTime          @default(now())
  createdIndependentHours IndependentHour[]
  user                    User              @relation(fields: [userId], references: [id])
  createdSupervisionHours SupervisionHour[]
}

model StudentPayment {
  id          String      @id @default(uuid())
  studentId   String
  paymentDate DateTime
  amount      Decimal     @db.Decimal(10, 2)
  paymentType PaymentType
  notes       String?
  createdAt   DateTime    @default(now())
  student     Student     @relation(fields: [studentId], references: [id])
}

model SupervisorPayment {
  id                  String     @id @default(uuid())
  supervisorId        String
  studentId           String
  monthYear           DateTime
  amountDue           Decimal    @db.Decimal(10, 2)
  amountPaidThisMonth Decimal    @db.Decimal(10, 2)
  amountAlreadyPaid   Decimal    @db.Decimal(10, 2)
  balanceDue          Decimal    @db.Decimal(10, 2)
  createdAt           DateTime   @default(now())
  student             Student    @relation(fields: [studentId], references: [id])
  supervisor          Supervisor @relation(fields: [supervisorId], references: [id])
}

model Invoice {
  id          String        @id @default(uuid())
  studentId   String
  invoiceDate DateTime
  amountDue   Decimal       @db.Decimal(10, 2)
  amountPaid  Decimal       @db.Decimal(10, 2)
  status      InvoiceStatus
  sentAt      DateTime?
  createdAt   DateTime      @default(now())
  student     Student       @relation(fields: [studentId], references: [id])
  supervisionHours SupervisionHour[]
}

model Document {
  id           String         @id @default(uuid())
  studentId    String?
  supervisorId String?
  documentType DocumentType
  fileUrl      String
  fileName     String
  fileSize     Int
  uploadedById String?
  uploadedAt   DateTime       @default(now())
  status       DocumentStatus @default(PENDING)
  student      Student?       @relation(fields: [studentId], references: [id])
  supervisor   Supervisor?    @relation(fields: [supervisorId], references: [id])
  uploadedBy   User?          @relation(fields: [uploadedById], references: [id])
}

model GroupSupervisionSession {
  id           String                       @id @default(uuid())
  supervisorId String
  date         DateTime
  startTime    DateTime
  topic        String
  maxStudents  Int                          @default(10)
  createdAt    DateTime                     @default(now())
  attendance   GroupSupervisionAttendance[]
  supervisor   Supervisor                   @relation(fields: [supervisorId], references: [id])
}

model GroupSupervisionAttendance {
  id        String                  @id @default(uuid())
  sessionId String
  studentId String
  attended  Boolean                 @default(true)
  createdAt DateTime                @default(now())
  session   GroupSupervisionSession @relation(fields: [sessionId], references: [id])
  student   Student                 @relation(fields: [studentId], references: [id])
}

model StudentEvaluation {
  id             String             @id @default(uuid())
  studentId      String
  supervisorId   String
  monthYear      DateTime
  criteria       EvaluationCriteria
  evaluationText String?
  createdAt      DateTime           @default(now())
  student        Student            @relation(fields: [studentId], references: [id])
  supervisor     Supervisor         @relation(fields: [supervisorId], references: [id])
}

model Contract {
  id              String               @id @default(uuid())
  studentId       String
  effectiveDate   DateTime
  status          ContractStatus       @default(DRAFT)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  student         Student              @relation(fields: [studentId], references: [id])
  supervisors     ContractSupervisor[]
}

model ContractSupervisor {
  id              String     @id @default(uuid())
  contractId      String
  supervisorId    String
  isMainSupervisor Boolean   @default(false)
  contract        Contract   @relation(fields: [contractId], references: [id], onDelete: Cascade)
  supervisor      Supervisor @relation(fields: [supervisorId], references: [id])

  @@unique([contractId, supervisorId])
}

model GeneralValues {
  id                          String   @id @default(uuid())
  rateRegular                 Decimal  @db.Decimal(10, 2)
  rateConcentrated            Decimal  @db.Decimal(10, 2)
  supervisorPaymentPercentage Decimal  @db.Decimal(5, 4)
  companyName                 String
  companyAddress              String
  companyPhone                String
  companyEmail                String
  companyWebsite              String   @default("")
  companyTaxId                String   @default("")
  companyLogoUrl              String   @default("")
  updatedAt                   DateTime @updatedAt
}

enum UserRole {
  STUDENT
  SUPERVISOR
  OFFICE
  QA
}

enum CredentialType {
  RBT
  RBT_NOT_WORKING
  BCaBA
  LMHC
  NO_CREDENTIAL
  BCBA
}

enum LevelType {
  BCaBA
  BCBA
}

enum SupervisionType {
  REGULAR
  CONCENTRATED
}

enum StudentStatus {
  ACTIVE
  PENDING
  COMPLETED
  WITHDRAWN
}

enum SupervisorStatus {
  ACTIVE
  WITHDRAWN
}

enum SettingType {
  CLIENTS_HOME
  SCHOOL
  DAYCARE
  OFFICE_CLINIC
  GROUP_HOME
  COMMUNITY
}

enum ActivityType {
  RESTRICTED
  UNRESTRICTED
}

enum SupervisionFormat {
  INDIVIDUAL
  GROUP
}

enum EvaluationCriteria {
  S
  NI
  U
  NA
}

enum PaymentType {
  ZELLE
  CHECK
  VENMO
  CASHAPP
  CASH
  PAYPAL
  BANK_TRANSFER
  CREDIT_CARD
}

enum DocumentType {
  IDENTIFICATION
  CLIENT_CONSENT
  PROOF_START_DATE
  ACADEMIC_DEGREE
  PREVIOUS_FINAL_FORM
  SIGNED_CONTRACT
  WC_EXEMPTION
  OTHER
}

enum InvoiceStatus {
  SENT
  PAID
  PARTIAL
  OVERDUE
}

enum ContractStatus {
  DRAFT
  ACTIVE
  SENT
  SIGNED
}

enum DocumentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum OfficeRole {
  SUPER_ADMIN
  ADMIN
}

enum NotificationType {
  SYSTEM
  CONTRACT
  DOCUMENT
  HOURS
}

enum HourStatus {
  PENDING
  APPROVED
  REJECTED
  BILLED
}

enum FieldworkType {
  REGULAR
  CONCENTRATED
}

